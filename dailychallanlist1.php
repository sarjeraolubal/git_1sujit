<html>  <head>    <title>       Display delevary challan ledger Report    </title>   <style>   .textright{	   text-align:right;   }   </style>  </head>  <body>    <h1>Displaying delevary challan ledger for members  </h1>        <form action="<?php $_SERVER['PHP_SELF']?>" method="post">		<label>Year(YYYYMM)</label><input type="year" name="year"/>		<label>CHALLAN No</label><input type="text" name="slip_no"/>		<label>Company Code</label><input type="text" name="comp_code"/>		<input type="submit"/>	    </form>    <?php	//require "dist/lib/commonfunc.php";//validatepage();require "dist/lib/dbconnection.php";//require "dist/lib/dataextrfunc.php";			   //  function mysql_escape_string($string){return mysqli_escape_string($string);}		     GLOBAL $selecteddata_list;         GLOBAL $List_Pay_MASTER ;		if((isset($_POST['year']))||(isset($_POST['slip_no']))||(isset($_POST['comp_code']))){		if($_POST['year']==""){$post_year='%';}else {$post_year=$_POST['year'];}		if($_POST['comp_code']==""){$post_comp_code='%';}else {$post_comp_code=$_POST['comp_code'];}		if($_POST['slip_no']==""){$post_slip_no='%';}else {$post_slip_no=$_POST['slip_no'];}		 		 		$selecteddata_list = search_datalist($post_year,$post_comp_code,$post_slip_no);				$List_Pay_MASTER  = List_Pay_M($selecteddata_list);		if ($List_Pay_MASTER == "SUCCESS"){ echo  $record_count . "  records inserted "; }                                      ELSE	{ echo  " NONE records inserted "; }								        // mysqli_close($connection);    }//close if    ?>     </body></html>    <?php          function search_datalist($post_year,$post_comp_code,$post_slip_no){          $extr_datalist = array();            $pdo = DBconnectionUtil::connect();           $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);         try{              $sql = "					SELECT DISTINCT lp_dc_pri_inf.sys_co_code AS co_code,                                    lp_dc_pri_inf.dwd_slip_nbr AS slip_no,                                    lp_dc_pri_inf.dwd_date AS slipdate,                                    lp_dc_pri_inf.dwd_matha AS matha,                                    lp_dc_gdtl.gm_badge_no AS badge_no,                                    lp_dc_gdtl.gm_gang_code AS gang_code,                                    lp_gang_m.gm_name AS name,                                    lp_dc_pri_inf.dwd_totalperson AS men_no,                                    lp_dc_pri_inf.dwd_total_amount AS amount1,									                                    lp_dc_pri_inf.vm_code,                                    lp_dc_pri_inf.cm_code                               FROM lp_dc_pri_inf                         INNER JOIN lp_dc_wdtl ON lp_dc_pri_inf.dwd_tabreckey =                                    lp_dc_wdtl.dwd_tabreckey                         INNER JOIN lp_work_tm ON lp_dc_wdtl.wtm_code = lp_work_tm.wtm_code                         INNER JOIN lp_dc_gdtl ON lp_dc_pri_inf.dwd_tabreckey =                                    lp_dc_gdtl.dwd_tabreckey                         INNER JOIN lp_gang_m ON lp_dc_gdtl.gm_badge_no = lp_gang_m.gm_badge_no                         INNER JOIN smestar_syscom ON lp_dc_pri_inf.sys_co_code =                                    smestar_syscom.sys_co_code                         INNER JOIN lp_vessel_m ON lp_dc_pri_inf.vm_code = lp_vessel_m.vm_code                         INNER JOIN lp_commo_m ON lp_dc_pri_inf.cm_code = lp_commo_m.cm_code                         INNER JOIN lp_labour_rm ON lp_dc_pri_inf.clrm_code = lp_labour_rm.clrm_code                         									HAVING	lp_dc_pri_inf.sys_co_code like '".$post_comp_code."'  AND  date_format(lp_dc_pri_inf.dwd_date,'%Y%m')    like '".$post_year."' AND slip_no like '".$post_slip_no."'		                                         ORDER BY co_code,                                 slip_no,	                               gang_code           									                 ";                $q = $pdo->prepare($sql);                $q->execute();        $extr_datalist = $q->fetchAll();		         }         catch (PDOException $sql_err) {	      $errmsg = "TechError: search data list:".$sql_err->getMessage().", contact system administrator";	        error_log($errmsg,0);                              }DBconnectionUtil::disconnect();return $extr_datalist;     }//-- List of  db table	                   function List_Pay_M(){                       $pdo = DBconnectionUtil::connect();                        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);                       GLOBAL $errmsg;                //-- For Gang Code							    GLOBAL $selecteddata_list;				global $record_count;                $record_count   = count($selecteddata_list);					//			foreach ($selecteddata_list as $row) {							//echo "<pre>";//print_r($selecteddata_list);//echo "</pre>";		 $slip_no_w = 	"";					   //  $slip_no_w = 	$selecteddata_list[0][1];		 $company_name =    $selecteddata_list[0][0];		 		 echo "Challan wise ledger For    " . $company_name  ;		 echo "  <br/>    ";		echo "No of Records  " . $record_count  ;		 		echo "  <br/>    ";		 		 		 		      echo "<table border='1'>";      echo "<tr>";	  	  	    	  	        echo "<th>Co<br/>CD</th> <th>Slip<br/> Number</th> <th> Date </th>  <th> Matha </th> <th> Badge <br/>(No.)</th>   <th> Gang <br/>Code</th> <th> Name </th> 	  <th> men<br/>(No.) </th><th> Total<br/>Amount </th><th> vessel<br/> code </th>                            ";/*	       $totalamount      = 0;	       $totalbag         = 0;		   $dayamount        = 0;           $daybag           = 0;			           $date_w           = $selecteddata_list[0][4];			           $vslbag           = 0;           $vslamount        = 0;			           $vsl_w            = $selecteddata_list[0][5]; ;						   $sumesic_e     = 0;           $sumsalary     = 0;			           $sumnet_salary = 0;				       $sumesic_o     = 0;         */					 $data_count = count($selecteddata_list);         foreach ($selecteddata_list as $row)       {	  	  	  	  	  			  $co_code      = $row['co_code'];			      $slip_no      = $row['slip_no'];				  $slipdate     = $row['slipdate'];				  $matha        = $row['matha'];				  $badge_no     = $row['badge_no'];				  $gang_code    = $row['gang_code'];				  $name         = $row['name'];			      $men_no       = $row['men_no'];				  $amount       = $row['amount1'];				 				  $vm_code      = $row['vm_code'];				  $cm_code	    = $row['cm_code'];	  	  	if  ($slip_no_w  == $slip_no) 		                        {		echo "<tr>";        echo 		   "<td>", "        ", "</td>	  	   <td>",  "   " ,  "</td> 		   <td>",  "   " , "</td> 		   <td>",  "   " , "</td> 		   <td class='textright' >", $badge_no     , "</td> 		   <td>", $gang_code    , "</td> 		   <td>", $name         , "</td> 		   <td>","   " , "</td> 		   <td>","   " , "</td> 		   <td>","   " , "</td> 			   ";  					 echo "</tr>";																			}ELSE																{									$slip_no_w  = $slip_no;							  	  	echo "<tr>";        echo "<td>", $co_code, "</td>		   <td>", $slip_no      , "</td> 		   <td>", $slipdate     , "</td> 		   <td  class='textright'>", $matha        , "</td> 		   <td class='textright'>", $badge_no     , "</td> 		   <td>", $gang_code    , "</td> 		   <td>", $name         , "</td> 		   <td  class='textright'>", $men_no       , "</td> 		   <td  class='textright'>", $amount       , "</td> 		   		   <td>", $vm_code      , "</td>   		   ";  			        echo "</tr>";										}																					/*	  		  		  		  	  	echo "<tr>";        echo "<td>", "        ", "</td>	  	  	 	  	   <td>", $co_code      , "</td> 		   <td>", $slip_no      , "</td> 		   <td>", $slipdate     , "</td> 		   <td>", $matha        , "</td> 		   <td>", $badge_no     , "</td> 		   <td>", $gang_code    , "</td> 		   <td>", $name         , "</td> 		   <td>", $men_no       , "</td> 		   <td>", $amount       , "</td> 		   <td>", $wtm_code     , "</td> 		   <td>", $wtm_name     , "</td> 		   <td>", $dwd_bags     , "</td> 		   <td>", $wtm_rate     , "</td> 	  	   <td>", $wtm_amount   , "</td> 	  	   <td>", $clrm_code    , "</td> 	  	   <td>", $clrm_desc    , "</td> 		   <td>", $dwd_labors   , "</td>   	       <td>", $clrm_rate    , "</td>   		   <td>", $vm_code      , "</td>   		   <td>", $cm_code	    , "</td>   		   <tdclass='textright'>", $dwd_lab_amount , "</td>";  	        echo "</tr>";*/		  	 }		                 }	        DBconnectionUtil::disconnect();return "SUCCESS";?>